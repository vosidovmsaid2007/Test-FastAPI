# FastAPI-Email-Confirmation-Server

## Описание
Простой проект FastAPI, предназначенный для регистрации пользователей по email с подтверждением по email.

## Содержание
- [Установка](#установка)
- [Использование](#использование)
- [API Эндпоинты](#api-эндпоинты)
- [Аутентификация](#аутентификация)
- [Структура Проекта](#структура-проекта)
- [Лицензия](#лицензия)

## Установка
Инструкции по установке проекта:

```bash
# Клонируйте репозиторий
git clone <repository-url>

# Перейдите в директорию проекта
cd <project-directory>

# Установите зависимости
poetry install --no-root
```

Миграции БД:
```bash
# Создание новой миграции с автогенерацией изменений в базе данных
poetry run alembic revision --autogenerate -m "Initial migration"

# Применение созданной миграции к базе данных
poetry run alembic upgrade head
```

## Использование
Для запуска сервера:
```bash
poetry run uvicorn main:app --reload
```
Допольнительные комманды:
 - `--host`: IP-адрес сервера, по умолчанию `127.0.0.1`
 - `--port`: Порт сервера, по умолчанию `8000`
 - `--reload`: Перезагрузка сервера при изменении кода


## API Эндпоинты

### Авторизация
- `POST /login`: Аутентификация пользователя
- `GET /validate_token`: Проверка токена

### Админ
- `GET /users/list`: Получение списка пользователей
- `POST /users/add`: Регистрация нового пользователя
- `PUT /users/{user_id}`: Обновление информации о пользователе
- `PUT /users/status/change`: Блокировка/разблокировка пользователя
- `GET /users/actions`: Просмотр истории действий пользователей

## Аутентификация
В проекте используется безопасный метод аутентификации пользователей с помощью хэширования паролей. Пароли пользователей хранятся в базе данных в виде хэшей с использованием библиотеки `bcrypt`, что исключает возможность их подбора.

### Управление сессиями

- Метод `create_session` создает новую сессию для пользователя и возвращает ее.
- По умолчанию для каждой сессии установлено время истечения, равное 8 часам. Это помогает снизить риск кражи сессий.
- Метод `is_active_and_not_expired` проверяет, активна ли сессия и не истек ли срок ее действия.

### Безопасность токенов
- Токены должны безопасно храниться на стороне клиента (например, в HTTP-only cookies) для предотвращения XSS-атак.
- Проект предоставляет конечную точку для проверки токенов, обеспечивая доступ только к действительным сессиям.
- Функция `user_make_all_sessions_inactive` может быть использована для аннулирования всех пользовательских сессий, что повышает безопасность в случае выхода пользователя из системы или смены пароля.

## Структура Проекта
Проект состоит из следующих компонентов:
```
/project-root
|-- app/                  # Главная директория приложения
|   |-- auth.py           # Логика аутентификации
|   |-- user.py           # Логика управления пользователями
|-- core/                 # Основные функциональности и конфигурации
|   |-- config.py         # Настройки конфигурации
|   |-- exceptions.py     # Обработка исключений
|-- db/                   # Модели и управление базой данных
|   |-- base.py           # Базовый класс для моделей
|   |-- user.py           # Модель пользователя и связанные функции базы данных
|-- dto/                  # Объекты передачи данных (DTO)
|   |-- application.py    # DTO, связанные с приложением
|   |-- auth.py           # DTO, связанные с аутентификацией
|   |-- static_types.py   # Статические типы
|   |-- user.py           # DTO, связанные с пользователем
|-- services/             # Бизнес-логика и слой сервисов
|   |--otp.py             # Сервис для отправки OTP-кодов
|-- usecases/             # Реализация вариантов использования (Use Cases)
|   |-- auth.py           # Использование аутентификации
|   |-- user.py           # Использование пользователей
|-- utils/                # Вспомогательные функции и утилиты
|   |-- aioclient.py      # Асинхронный HTTP-клиент
|   |-- log.py            # Логирование
|   |-- middlewares.py    # Мидлвары
|-- .env                  # Конфигурация переменных окружения
|-- .gitignore            # Указывает файлы и директории, которые нужно игнорировать в Git
|-- Dockerfile            # Конфигурационный файл Docker для контейнеризации
|-- README.md             # Документация проекта
|-- alembic.ini           # Конфигурация Alembic для миграций базы данных
|-- main.py               # Главная точка входа в приложение
|-- poetry.lock           # Зафиксированные зависимости для проекта
|-- pyproject.toml        # Конфигурация проекта и зависимости
```

## Лицензия
Проект распространяется по лицензии [MIT](https://opensource.org/licenses/MIT).
